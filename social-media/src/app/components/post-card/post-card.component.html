<article class="post-card">
  <div class="post-header">
    <div class="author-info">
      <img [src]="post.author.avatar" [alt]="post.author.name" class="author-avatar" />
      <div class="author-details">
        <p class="author-name">{{ post.author.name }}</p>
        <p class="author-handle">{{ post.author.username }} Â· {{ post.timestamp }}</p>
      </div>
    </div>
    <button class="more-btn">
      <lucide-icon [img]="moreIcon"></lucide-icon>
    </button>
  </div>

  <p class="post-content" [innerHTML]="post.content | contentLink" (click)="onContentClick($event)"></p>

  <img *ngIf="post.image" [src]="post.image" [alt]="post.content" class="post-image" />

  <!-- Reaction Summary -->
  @if (counts && counts.total > 0) {
    <app-reaction-summary [counts]="counts"></app-reaction-summary>
  }

  <!-- Reaction Bar -->
  @if (counts) {
    <app-reaction-bar
      [postId]="post.id"
      [counts]="counts"
      [userReaction]="userReaction"
      (reactionSelected)="onReactionSelected($event)">
    </app-reaction-bar>
  }

  <div class="post-stats">
    <span>{{ counts.total || post.likes }} reactions</span>
    <span>{{ post.comments }} comments</span>
    <span>{{ post.shares }} shares</span>
  </div>

  <div class="post-actions">
    <button
      class="action-btn"
      [class.liked]="isLiked"
      (click)="toggleLike()"
    >
      <lucide-icon [img]="heartIcon" [class.fill-icon]="isLiked"></lucide-icon>
      <span class="label">{{ userReaction ? userReaction : 'Like' }}</span>
    </button>
    <button class="action-btn" (click)="toggleComments()">
      <lucide-icon [img]="commentIcon"></lucide-icon>
      <span class="label">Comment</span>
    </button>
    <button class="action-btn" (click)="openShare()">
      <lucide-icon [img]="shareIcon"></lucide-icon>
      <span class="label">Share</span>
    </button>
    <button
      class="action-btn"
      [class.saved]="isSaved"
      (click)="toggleSave()"
    >
      <lucide-icon [img]="bookmarkIcon" [class.fill-icon]="isSaved"></lucide-icon>
      <span class="label">Save</span>
    </button>
  </div>

  @if (commentsOpen) {
    <app-comment-input
      [isReply]="!!replyingTo"
      [placeholder]="replyingTo ? 'Write a reply...' : 'Share your thoughts...'"
      [autoFocus]="true"
      (submitted)="onCommentSubmitted($event)"
      (cancelled)="onReplyCancelled()">
    </app-comment-input>

    <app-comment-list
      [postId]="'' + post.id"
      (replyClicked)="onReplyClicked($event)"
      (likeClicked)="onLikeClicked($event)">
    </app-comment-list>
  }

  <app-share-modal
    [isOpen]="shareModalOpen"
    [postId]="'' + post.id"
    [postUrl]="shareUrl"
    [postText]="post.content"
    (closed)="closeShare()">
  </app-share-modal>
</article>
