<div class="explore-container">
  <div class="explore-header">
    <h1>Explore</h1>
    <p class="subtitle">Discover trending topics and connect with creators</p>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <div class="search-input-wrapper">
      <lucide-angular [img]="searchIcon" class="search-icon"></lucide-angular>
      <input
        type="text"
        class="search-input"
        placeholder="Search topics, hashtags, or people..."
        (input)="onSearchInput($event)"
        [value]="searchQuery()"
      />
      @if (searchQuery()) {
        <button class="clear-btn" (click)="searchQuery.set('')">Ã—</button>
      }
    </div>
    <button class="refresh-btn" (click)="refreshContent()" [class.loading]="isLoading()" title="Refresh">
      <lucide-angular [img]="refreshIcon" [size]="18"></lucide-angular>
    </button>
  </div>

  <!-- Category Filters -->
  <div class="category-filters">
    @for (category of categories; track category.id) {
      <button
        class="filter-btn"
        [class.active]="selectedCategory() === category.id"
        (click)="selectCategory(category.id)"
        [style.--category-color]="category.color"
      >
        <span class="category-icon">{{ category.icon }}</span>
        <span class="category-name">{{ category.name }}</span>
      </button>
    }
  </div>

  <div class="explore-layout">
    <!-- Main Content -->
    <main class="explore-main">
      <!-- Featured Content Carousel -->
      <section class="featured-section">
        <div class="section-header">
          <lucide-angular [img]="trendingIcon" class="section-icon"></lucide-angular>
          <h2>Featured</h2>
        </div>

        <div class="featured-carousel">
          @if (hasMultipleSlides) {
            <button class="carousel-nav prev" (click)="prevSlide()" [class.disabled]="currentSlide() === 0">
              <lucide-angular [img]="chevronLeft" [size]="20"></lucide-angular>
            </button>
          }

          <div class="featured-slides">
            @for (topic of featuredTopics; track topic.id; let i = $index) {
              <a 
                [routerLink]="['/hashtag', topic.title]" 
                class="featured-slide"
                [class.active]="currentSlide() === i"
                [style.background]="topic.gradient"
              >
                <div class="slide-content">
                  <span class="slide-category">{{ getCategoryName(topic.category) }}</span>
                  <h3 class="slide-title">#{{ topic.title }}</h3>
                  <p class="slide-posts">{{ formatPostCount(topic.posts) }} posts</p>
                </div>
              </a>
            }
          </div>

          @if (hasMultipleSlides) {
            <button class="carousel-nav next" (click)="nextSlide()">
              <lucide-angular [img]="chevronRight" [size]="20"></lucide-angular>
            </button>
          }

          @if (hasMultipleSlides) {
            <div class="carousel-dots">
              @for (topic of featuredTopics; track topic.id; let i = $index) {
                <button 
                  class="dot" 
                  [class.active]="currentSlide() === i"
                  (click)="goToSlide(i)"
                ></button>
              }
            </div>
          }
        </div>
      </section>

      <!-- Trending Topics Grid -->
      <section class="trending-section">
        <div class="section-header">
          <lucide-angular [img]="hashtagIcon" class="section-icon"></lucide-angular>
          <h2>Trending Topics</h2>
        </div>

        @if (trendingTopics.length > 0) {
          <div class="topics-grid">
            @for (topic of trendingTopics; track topic.id) {
              <a [routerLink]="['/hashtag', topic.title]" class="topic-card">
                <div class="topic-gradient" [style.background]="topic.gradient"></div>
                <div class="topic-content">
                  <div class="topic-header">
                    <lucide-angular [img]="hashtagIcon" class="topic-icon"></lucide-angular>
                    <span class="topic-category">{{ getCategoryName(topic.category) }}</span>
                  </div>
                  <h3 class="topic-title">#{{ topic.title }}</h3>
                  <p class="topic-posts">{{ formatPostCount(topic.posts) }} posts</p>
                </div>
              </a>
            }
          </div>

          @if (hasMore()) {
            <div class="load-more-container">
              <button class="load-more-btn" (click)="loadMore()">
                Load more topics
              </button>
            </div>
          }
        } @else {
          <div class="empty-state">
            <p>No topics found for "{{ searchQuery() }}"</p>
          </div>
        }
      </section>
    </main>

    <!-- Sidebar - Suggested Users -->
    <aside class="explore-sidebar">
      <div class="suggestions-card">
        <div class="section-header">
          <lucide-angular [img]="usersIcon" class="section-icon"></lucide-angular>
          <h2>Suggested Users</h2>
        </div>

        <div class="suggestions-list">
          @for (user of suggestedUsers; track user.username) {
            <div class="suggestion-item">
              <a [routerLink]="['/profile', user.username]" class="user-link">
                <img [src]="user.avatar" [alt]="user.name" class="user-avatar" />
                <div class="user-info">
                  <p class="user-name">{{ user.name }}</p>
                  <p class="user-handle">&#64;{{ user.username }}</p>
                  <p class="user-bio">{{ user.bio }}</p>
                </div>
              </a>
              <button
                class="follow-btn"
                [class.following]="exploreService.isFollowing(user.username)"
                (click)="toggleFollow(user.username)"
              >
                {{ exploreService.isFollowing(user.username) ? 'Following' : 'Follow' }}
              </button>
            </div>
          }
        </div>
      </div>

      <!-- Top Trending Mini Card -->
      <div class="top-trending-card">
        <div class="section-header">
          <lucide-angular [img]="trendingIcon" class="section-icon"></lucide-angular>
          <h2>Top Trending</h2>
        </div>

        <div class="top-trending-list">
          @for (topic of topTrending; track topic.id; let i = $index) {
            <a [routerLink]="['/hashtag', topic.title]" class="top-trending-item">
              <span class="trend-rank" [class.top-3]="i < 3">{{ i + 1 }}</span>
              <div class="trend-info">
                <p class="trend-title">#{{ topic.title }}</p>
                <p class="trend-count">{{ formatPostCount(topic.posts) }} posts</p>
              </div>
            </a>
          }
        </div>
      </div>

      <!-- Activity Feed -->
      <app-activity-feed></app-activity-feed>
    </aside>
  </div>
</div>
