<div class="reply-form" [class.focused]="isFocused">
  @if (isFocused || content) {
    <div class="form-header">
      <img src="https://i.pravatar.cc/150?img=1" alt="Your avatar" class="form-avatar" />
    </div>
  }

  <div class="form-content">
    <textarea
      class="reply-textarea"
      [placeholder]="placeholder"
      [(ngModel)]="content"
      (focus)="onFocus()"
      (blur)="onBlur()"
      [disabled]="isSubmitting"
      rows="2"
    ></textarea>

    @if (isFocused || content) {
      <div class="form-actions">
        <div class="left-actions">
          <button 
            type="button" 
            class="emoji-btn" 
            (click)="toggleEmojiPicker()"
            title="Add emoji"
          >
            <lucide-icon [img]="smileIcon"></lucide-icon>
          </button>

          <span class="char-count" [class.over]="isOverLimit">
            {{ remaining }}
          </span>
        </div>

        <div class="right-actions">
          @if (parentReplyId) {
            <button type="button" class="cancel-btn" (click)="cancel()">
              <lucide-icon [img]="closeIcon"></lucide-icon>
            </button>
          }

          <button 
            type="button" 
            class="submit-btn" 
            [disabled]="!canSubmit"
            (click)="onSubmit()"
          >
            @if (isSubmitting) {
              <span class="loading-spinner"></span>
              <span>Posting...</span>
            } @else {
              <lucide-icon [img]="sendIcon"></lucide-icon>
              <span>Reply</span>
            }
          </button>
        </div>
      </div>

      <!-- Emoji Picker -->
      @if (showEmojiPicker) {
        <div class="emoji-picker">
          @for (emojiRow of emojis | slice:0:12; track emojiRow) {
            <button 
              class="emoji-btn-picker" 
              (click)="addEmoji(emojiRow)"
              type="button"
            >
              {{ emojiRow }}
            </button>
          }
        </div>
      }
    }
  </div>
</div>
